{% for post in site.posts %}
    {% unless post.draft %}
        {% capture this_year %}{{ post.date | date: "%Y" }}{% endcapture %}
        {% capture next_year %}{{ post.previous.date | date: "%Y" }}{% endcapture %}

        {% if forloop.first %}
        <ul class="category {{uri_escape | downcase | slugify}}">
        <h3 class="title" id="{{uri_escape | downcase | slugify }}">{{this_year}}</h3>
        {% endif %}

        {% if post.menutitle %}
        {% assign title = post.menutitle %}
        {% else %}
        {% assign title = post.title %}
        {% endif %}

        <li>
            <div class="article">
                <article class="article" itemscope itemtype="http://schema.org/BlogPosting">
                    <header class="post-header">
                        <span class="title"><a itemprop="name" href="{{ post.url | prepend: site.github.url | prepend: site.baseurl }}" title="{{ title }}">{{ title }}</a></span>
                        <time class="date" itemprop="datePublished" datetime="{{post.date | date: "%Y-%m-%d"}}">{{post.date | date: "%B %e, %Y"}}</time>
                    </header>
                </article>
            </div>
        </li>

        {% if forloop.last %}
        </ul>
        {% else %}
            {% if this_year != next_year %}
            </ul>
            <ul class="category {{uri_escape | downcase | slugify}}">
            <h3 class="title" id="{{uri_escape | downcase | slugify }}">{{next_year}}</h3>
            {% endif %}
        {% endif %}
      {% endunless %}
      {% endfor %}
